<!DOCTYPE html>
<html>
<head>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/styles.css') }}">
    <title>Construction Data Analysis</title>
</head>
<body>
 <!-- stats - count particles -->
    <div class="container">
    <h1>Construction Data Analysis Tool</h1>

    <!-- File Upload Form -->
    <form id="upload-form"  class="form-container" enctype='multipart/form-data'>
        <div class="upload-files-container">
		<div class="drag-file-area">
            <h3 class="dynamic-message"> Drag & drop any file here </h3><br/>
            <label class="label"> <span class="browse-files-text">from device</span> </span> </label>
		</div></div>
      <!--  <input type="file" class  ="file-buttom" name="file" id="file-upload"> -->
    </form>
        <input type="button" class = "input" value="Upload Data" onclick="uploadFile()">

    <!-- Variable Selection -->
    <div id="variable-selection">
        <!-- Checkboxes for variable selection will be populated here -->
    </div>

    <!-- Target Column Selection -->
    <label for="target-column">Select Target Column:</label>
    <select id="target-column">
        <!-- Options for target column will be populated here -->
    </select>

    <!-- Start Prediction Button -->
    <button class =  "submit"onclick="startPrediction()">Start Prediction</button>

    <!-- Result Display -->
    <div id="results">
        <!-- Prediction results will be displayed here -->
</div>
    </div>
<div id="particles-js"></div>
</body>
<script>
    function uploadFile() {
        var formData = new FormData(document.getElementById('upload-form'));
        formData.append('file', document.getElementById('file-upload').files[0]);
        fetch('/upload', {
            method: 'POST',
            body: formData
        }).then(response => response.json())
            .then(data => {
                populateVariableSelection(data.columns);
            }).catch(error => console.error('Error:', error));
    }

    function populateVariableSelection(columns) {
        var selectionDiv = document.getElementById('variable-selection');
        var targetColumnSelect = document.getElementById('target-column');
        selectionDiv.innerHTML = '';
        targetColumnSelect.innerHTML = '';

        columns.forEach(column => {
            // Checkbox for variable selection
            var checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = column;
            checkbox.name = 'variables';
            checkbox.value = column;

            var label = document.createElement('label');
            label.htmlFor = column;
            label.appendChild(document.createTextNode(column));

            selectionDiv.appendChild(checkbox);
            selectionDiv.appendChild(label);
            selectionDiv.appendChild(document.createElement('br'));

            // Option for target column
            var option = document.createElement('option');
            option.value = column;
            option.text = column;
            targetColumnSelect.appendChild(option);
        });
    }

    function startPrediction() {
        var selectedVariables = Array.from(document.querySelectorAll('input[name="variables"]:checked')).map(cb => cb.value);
        var targetColumn = document.getElementById('target-column').value;
        var formData = new FormData();

        console.log(selectedVariables + "and " + targetColumn + "and");
        formData.append('selected_columns', JSON.stringify(selectedVariables));
        formData.append('target_column', targetColumn);
        formData.append('data', document.getElementById('file-upload').files[0]);

        fetch('/predict', {
            method: 'POST',
            body: formData
        }).then(response => response.json())
            .then(data => {
                displayResults(data);
            }).catch(error => console.error('Error:', error));
    }

    function displayResults(data) {
        if (data.error) {
            alert(data.error);
            return;
        }
        var resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<img src="data:image/png;base64,' + data.plot_url + '" />';
        // Display other results as needed
    }
</script>
</body>
<script src="http://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script> <!-- stats.js lib -->

<script>particlesJS("particles-js", {
    particles: {
        number: {value: 5, density: {enable: true, value_area: 200}},
        color: {value: "random"},
        shape: {
            type: "circle",
            stroke: {width: 0.3, color: "#ffffff"},
            polygon: {nb_sides: 5},
            image: {src: "./images/111.jpg", width: 1, height: 100}
        },
        opacity: {
            value: 1.7,
            random: true,
            anim: {enable: false, speed: 0.6, opacity_min: 0.4, sync: false}
        },
        size: {
            value: 1.8,
            random: false,
            anim: {enable: false, speed: 40, size_min: 0.1, sync: false}
        },
        line_linked: {
            enable: false,
            distance: 100,
            color: "#a85e32",
            opacity: 0.9,
            width: 2.62
        },
        move: {
            enable: true,
            speed: 2,
            direction: "none",
            random: true,
            straight: false,
            out_mode: "out",
            bounce: true,
            attract: {enable: true, rotateX: 600, rotateY: 1200}
        }
    },
    interactivity: {
        detect_on: "canvas",
        events: {
            onhover: {enable: true, mode: "grab"},

            resize: true
        },
        modes: {
            grab: {distance: 120, line_linked: {opacity: 3}},
            bubble: {distance: 400, size: 40, duration: 2, opacity: 8, speed: 3},
            repulse: {distance: 200, duration: 0.4},
            push: {particles_nb: 4},
            remove: {particles_nb: 2}
        }
    },
    retina_detect: true
});
var count_particles, stats, update;
stats = new Stats();
stats.setMode(0);
stats.domElement.style.position = "relative";
stats.domElement.style.left = "0px";
stats.domElement.style.top = "0px";
document.body.appendChild(stats.domElement);
count_particles = document.querySelector(".js-count-particles");
update = function () {
    stats.begin();
    stats.end();
    if (window.pJSDom[0].pJS.particles && window.pJSDom[0].pJS.particles.array) {
        count_particles.innerText = window.pJSDom[0].pJS.particles.array.length;
    }
    requestAnimationFrame(update);
};
requestAnimationFrame(update);
</script>

</html>


